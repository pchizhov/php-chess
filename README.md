## Бэкэнд для проведения шахматной партии

### 1. Фигуры

В директории **pieces** находятся классы фигур, хранящие информацию о их цвете (1 - белые, 0 - черные), ходах в виде сдвигов относительно текцщего положения, а также информация о том, была ли фигура использована.
Все фигуры наследуются от класса **ChessPiece** с абстрактным методом *to_move()*, возвращающим возможные ходы фигуры.

### 2. Доска

 В директории **board** находятся классы доски (**ChessBoard**) и клетки (**Cell**). Доска содержит в себе двумерный массив клеток, умеет выдавать клетку по ее координатам и выдавать соседа клетки по сдвигу.
 Клетка содержит в себе **PieceManager** - обертку над фигурой, о ней далее. Может менять находящуюся в ней фигуру.
 
### 3. Менеджеры фигур

В директории **game/managers** находятся менеджеры фигур. У них есть фигура и клетка, в которой она находится. В зависимости от типа фигуры 
соответствующий менеджер умеет выдавать массив обектов классов-наследников класса **Move**, то есть ходов.
Стоит отметить, что для некоторых типов фигур годится один и тот же менеджер, например:

* **ForwardManager** годится для фигур, которые двигаются до ближайшей занятой клетки (не умеют "перепрыгивать").
К ним относятся Ферзь (**Queen**), Слон (**Bishop**) и Ладья (**Rook**). У ладьи есть свой менеджер, наследующийся от **ForwardManager**,
так как у ладьи есть уникальный ход - рокировка;
* **SimpleManager** годится для фигур, смещения которых и являются их ходами. К ним относятся Конь (**Knight**) и Король (**King**). У короля
есть свой менеджер, наследующийся от **SimpleManager**, так как у короля есть уникальный ход - рокировка;
* Пешка - единственная фигура, у которой полностью отличаются обычные ходы и ходы со съедением, а также есть Превращение пешки,
поэтому для пешки сделан отдельный менеджер.

### 4. Ходы

В директории **game/moves** находятся классы возможных ходов:

* **SimpleMove** - обычный ход (продвижение фигуры с возможным съеданием фигуры соперника);
* **Castling** - рокировка;
* **PawnPromotion** - превращение пешки.

Все ходы могут быть выполнены (*execute()*) или отменены (*undo()*).

### 5. Игра

Класс **Game** служит для проведения партии и внешнего взаимодействия с сервисом. В нем есть статические поля для доски,
игроков (двумерный массив менеджеров фигур), а также история ходов и другие вспомогательные поля. В этом классе есть фабричный метод
*create_piece()* для создания фигуры по типу, цвету и позиции на доске. Метод возвращает соответствующего менеджера, предварительно добавив его
к массиву фигур соответствующего игрока. Метод *put_pieces()* ставит фигуры соответствующего цвета на доску для начала игры.

Методы для проведения игры:

* *select_cell()* - игрок, чья очередь ходить, выбирает одну из клеток и ему предлагается набор легальных ходов (возврат метода);
* *move()* - выполнение выбранного игроком хода;
* *under_check()* - проверка, поставлен ли мат выбранному (текущему, по умолчанию) игроку;
* *under_checkmate()* - проверка, поставлен ли мат выбранному (текущему, по умолчанию) игроку.

### 6. API

Классы **APIEngine** и **ChessAPI** служат для запросов к сервису, текущее состояние доски хранится в файле **game.json**. Запросы выполняются в виде *.../index.php?chessapi.{method_name}={params}*. Можно запросить:

* *new_game* - запрос для начала новой игры, выполняется без параметров, возвращается игровое поле в *.json*;
* *select_cell* - запрос для выбора клетки, параметр - массив из двух чисел вида \[i, j\], возвращаются допустимые ходы из этой клетки;
* *execute_move* - запрос для выполнения хода, параметр - ход в формате *.json*, аналогично возврату *select_cell*;
* *under_check* - запрос для проверки на шах введенному игроку, параметр - 0 или 1;
* *under_checkmate* - запрос для проверки на мат введенному игроку, параметр - 0 или 1;
* *get_board* - запрос для получения текущего состояния поля, без параметров;
* *get_current_player* - запрос для получения номера текущего игрока, без параметров.
